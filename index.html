<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –∞–≤—Ç–æ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="src/styles/app1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Top Panel -->
        <div class="top-panel">
            <h1 class="main-title">–ú–æ–∏ –∞–≤—Ç–æ</h1>
            <div class="control-buttons">
                <button class="add-car-button">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>

        <!-- Auth Container -->
        <div class="auth-container" id="authContainer">
            <div class="auth-content">
                <p>–î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram</p>
                <div id="telegram-login">
                    <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="MycarsCLOWNADESbot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
                </div>
            </div>
        </div>

        <!-- Car List -->
        <div class="car-list" id="carList">
            <!-- Cars will be added here dynamically -->
        </div>
    </div>

    <!-- Add Car Modal -->
    <div class="modal" id="addCarModal">
        <div class="modal-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h2>
            <form id="addCarForm">
                <div class="form-group">
                    <label for="carName">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—à–∏–Ω—ã*</label>
                    <input type="text" id="carName" required>
                </div>
                <div class="form-group">
                    <label for="mileage">–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–±–µ–≥ (–∫–º)*</label>
                    <input type="number" id="mileage" required>
                </div>
                <div class="form-group">
                    <label for="vin">VIN*</label>
                    <input type="text" id="vin" required>
                </div>
                <div class="form-group">
                    <label for="plate">–ù–æ–º–µ—Ä –º–∞—à–∏–Ω—ã*</label>
                    <input type="text" id="plate" required>
                </div>
                <div class="form-group">
                    <label for="purchaseDate">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏*</label>
                    <input type="date" id="purchaseDate" required>
                </div>
                <div class="form-group">
                    <label for="lastOilChange">–ü—Ä–æ–±–µ–≥ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–º–µ–Ω–µ –º–∞—Å–ª–∞ (–∫–º)*</label>
                    <input type="number" id="lastOilChange" required>
                </div>
                <div class="form-group">
                    <label for="lastTimingBelt">–ü—Ä–æ–±–µ–≥ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–º–µ–Ω–µ –ì–†–ú (–∫–º)*</label>
                    <input type="number" id="lastTimingBelt" required>
                </div>
                <div class="form-group">
                    <label for="insuranceEnd">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏*</label>
                    <input type="date" id="insuranceEnd" required>
                </div>
                <div class="form-group">
                    <label for="maintenanceEnd">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¢–û*</label>
                    <input type="date" id="maintenanceEnd" required>
                </div>
                <div class="form-group">
                    <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="description" rows="4" placeholder="–î–æ–±–∞–≤—å—Ç–µ –ª—é–±—É—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"></textarea>
                </div>
                <div class="form-group">
                    <label for="link1">–°—Å—ã–ª–∫–∞ 1</label>
                    <input type="url" id="link1">
                </div>
                <div class="form-group">
                    <label for="link2">–°—Å—ã–ª–∫–∞ 2</label>
                    <input type="url" id="link2">
                </div>
                <div class="form-group">
                    <label for="link3">–°—Å—ã–ª–∫–∞ 3</label>
                    <input type="url" id="link3">
                </div>
                <div class="form-group">
                    <label for="link4">–°—Å—ã–ª–∫–∞ 4</label>
                    <input type="url" id="link4">
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="save-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="cancel-button">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View/Edit Car Modal -->
    <div class="modal" id="viewCarModal">
        <div class="modal-content">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ</h2>
            <div class="car-info">
                <!-- Car info will be populated dynamically -->
            </div>
            <div class="modal-buttons">
                <button class="edit-button">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="delete-button">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="close-button">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="dialog-content">
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª—å?</p>
            <div class="dialog-buttons">
                <button class="confirm-button">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="cancel-button">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script src="src/scripts/app1.js"></script>
<!-- –í—Å—Ç–∞–≤—å—Ç–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º </body> -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<script>
  // –ö–æ–Ω—Ñ–∏–≥ (–∑–∞–º–µ–Ω–∏—Ç–µ appId –Ω–∞ –≤–∞—à!)
  const firebaseConfig = {
    apiKey: "5BaJOC0M4wQijmt8jCq1qgpg0iKpNfpSV5SrzCbx",
    authDomain: "telegramstorage-5e85f.firebaseapp.com",
    databaseURL: "https://telegramstorage-5e85f.firebaseio.com",
    projectId: "telegramstorage-5e85f",
    storageBucket: "telegramstorage-5e85f.appspot.com",
    messagingSenderId: "794673027643",
    appId: "1:794673027643:web:92a8afcdb21d7ccb729a1e" // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ!
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  database.ref('.info/connected').on('value', (snapshot) => {
    console.log(snapshot.val() ? "üî• Firebase –ø–æ–¥–∫–ª—é—á—ë–Ω!" : "‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è");
  });

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
  function saveUserData(userId, data) {
    database.ref('users/' + userId).set(data)
      .then(() => console.log("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firebase!"))
      .catch(error => console.error("–û—à–∏–±–∫–∞:", error));
  }

  function loadUserData(userId, callback) {
    database.ref('users/' + userId).once('value')
      .then(snapshot => callback(snapshot.val() || {}))
      .catch(error => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error));
  }

  // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp
  document.addEventListener('DOMContentLoaded', () => {
    const tgUser = Telegram.WebApp.initDataUnsafe?.user;
    
    if (tgUser) {
      const userId = tgUser.id.toString();
      console.log("ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram:", userId);

      // –ü—Ä–∏–º–µ—Ä: –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
      loadUserData(userId, (data) => {
        console.log("–î–∞–Ω–Ω—ã–µ –∏–∑ Firebase:", data);
        if (Object.keys(data).length === 0) {
          console.log("–î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ...");
          saveUserData(userId, { 
            name: tgUser.first_name || "–ì–æ—Å—Ç—å",
            createdAt: new Date().toISOString() 
          });
        }
      });

      // –ü—Ä–∏–º–µ—Ä: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–Ω–æ–ø–∫–µ (–¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –≤ HTML)
      document.getElementById('save-btn')?.addEventListener('click', () => {
        const userData = { 
          lastUpdate
</body>
</html> 
